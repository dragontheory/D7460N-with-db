<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="D7460N" />
    <meta name="description" content="Could tell you, but then I'd have to... well, you know." />
    <meta name="color-scheme" content="dark light" />
    <title>D7460N</title>
    <link type="image/svg+xml" rel="icon" href="assets/images/logo.svg" />
    <link type="text/css" rel="stylesheet" href="assets/css/styles.css" />
    <style type="text/acss">

	/***
	 * Developer defined variables for setting up data schema.
	**/
	body:preInit {
		/* Define API */
		$rowPopulationURL: "https://activecss.org/get-supes.php";
		$asidePopulationURL: "https://activecss.org/get-supe.php?id={@data-id}";
		$apiSchema: {
			id: { displayTitle: "ID", apiLocation: "id" },
			slug: { displayTitle: "", apiLocation: "slug" },
			alias: { displayTitle: "Alias", apiLocation: "name" },
			name: { displayTitle: "Real name", apiLocation: "biography.fullName" },
			alignment: { displayTitle: "Status", apiLocation: "biography.alignment" },
			affiliations: { displayTitle: "Affiliations", apiLocation: "connections.groupAffiliation" },
			power: { displayTitle: "Power", apiLocation: "powerstats.power" },
			intelligence: { displayTitle: "Intelligence", apiLocation: "powerstats.intelligence" },
			strength: { displayTitle: "Strength", apiLocation: "powerstats.strength" },
			speed: { displayTitle: "Speed", apiLocation: "powerstats.speed" },
			durability: { displayTitle: "Durability", apiLocation: "powerstats.durability" },
			combat: { displayTitle: "Combat", apiLocation: "powerstats.combat" },
			gender: { displayTitle: "Gender", apiLocation: "appearance.gender" },
			race: { displayTitle: "Race", apiLocation: "appearance.race" },
			heightInches: { displayTitle: "Height", apiLocation: "appearance.height[0]" },
			heightCm: { displayTitle: "Height", apiLocation: "appearance.height[1]" },
			weightPounds: { displayTitle: "Weight", apiLocation: "appearance.weight[0]" },
			weightKilos: { displayTitle: "Weight", apiLocation: "appearance.weight[1]" },
			eyeColor: { displayTitle: "Eye color", apiLocation: "appearance.eyeColor" },
			hairColor: { displayTitle: "Hair color", apiLocation: "appearance.hairColor" },
			alterEgos: { displayTitle: "Alter egos", apiLocation: "biography.alterEgos" },
			placeOfBirth: { displayTitle: "Place of birth", apiLocation: "biography.placeOfBirth" },
			firstAppearance: { displayTitle: "First appearance", apiLocation: "biography.firstAppearance" },
			publisher: { displayTitle: "Publisher", apiLocation: "biography.publisher" },
			occupation: { displayTitle: "Occupation", apiLocation: "work.occupation" },
			base: { displayTitle: "Base", apiLocation: "work.base" },
			relatives: { displayTitle: "Relatives", apiLocation: "connections.relatives" },
			image_xs: { displayTitle: "Extra small image", apiLocation: "images.xs" },
			image_sm: { displayTitle: "Small image", apiLocation: "images.sm" },
			image_md: { displayTitle: "Medium image", apiLocation: "images.md" },
			image_lg: { displayTitle: "Large image", apiLocation: "images.lg" },
		};

		/* Define which fields to display in each row. */
		$rowFields: [ 'id', 'alias', 'name', 'alignment', 'affiliations', 'power' ];

		/* Define which fields to display in the aside. */
		$asideFields: [ 'id', 'alias', 'name', 'alignment', 'affiliations', 'power', 'intelligence', 'strength', 'speed', 'durability', 'combat',
			'gender', 'race', 'heightInches', 'heightCm', 'weightPounds', 'weightKilos', 'eyeColor', 'hairColor', 'alterEgos', 'placeOfBirth',
			'firstAppearance', 'publisher', 'occupation', 'base', 'relatives', 'image_xs', 'image_sm', 'image_md', 'image_lg'
		];
	}


	/***
	 * Functionality variables for the app prior to initialization.
	**/
	body:preInit {
		$totalVisible: 0;
		$totalNonVisible: 0;
		$liCo: 0;
		$startingLiCo: 0;
	}


	/***
	 * Call data on body init.
	**/

	body:init {
		app-panel:nth-of-type(3) panel-list list-item {
			$liCo++;
		}
		app-panel:nth-of-type(3) panel-list {
			trigger: countRows;
		}
		app-panel:nth-of-type(3) panel-list {
			ajax: "{$rowPopulationURL}" get json await;
			/* ajax: "https://dragontheory.com/json/D7460N.json" get json await; */
			/* Pre-fetch JSON on mouseover to make the user think it's really quick. 
			app-panel:nth-of-type(3) panel-list list-item:not-if-var($currentUserID "{@data-id}"):mouseover {
			ajax-pre-get: "https://my-json-server.typicode.com/dragontheory/D7460N-data/names/{@data-id}" get json;
			}*/
			console-log: "getting here";
			trigger: setup;
			$startingLiCo: $liCo;
			@each $item in {JSON}.data {
				$liCo++;
				$rowHTML: "<list-item data-co='{$liCo}' data-id='" + escapeHTML(getVar($item, $apiSchema['id'].apiLocation)) + "'><list-cell><input type='checkbox' id='' name='table-row' value='' /></list-cell>";
				@each $fieldKey in $rowFields {
					$rowHTML: $rowHTML + "<list-cell>" + escapeHTML(getVar($item, $apiSchema[$fieldKey].apiLocation)) + "</list-cell>";
				}
				$rowHTML: $rowHTML + "</list-item>";
				render-before-end: "{$rowHTML}";
			}

			trigger: countRows;
		}
	}


	/***
	 * Draw the row headings.
	**/
	list-headings:draw {
		$headingsHTML: "<list-cell><input type='checkbox'></list-cell>";
		@each $fieldKey in $rowFields {
			$headingsHTML: $headingsHTML + "<list-cell>" + $apiSchema[$fieldKey].displayTitle + "</list-cell>";
		}
		render-replace: "{$headingsHTML}";
	}


	/***
	 * This is the custom event - it gets used twice - once when the page is drawn and again when the button is clicked.
	**/
	app-panel:nth-of-type(3) panel-list:countRows {
		@for $n from $startingLiCo + 1 to $liCo {
			@if completely-visible(list-item[data-co="{$n}"]) {
				$totalVisible++;
			} @else {
				$totalNonVisible++;
			}
		}
		#visibleCount {
			@if $totalVisible < 10 {
				render: "0{$totalVisible}";
			} @else {
				render: "{$totalVisible}";
			}
		}
		#nonVisibleCount {
			@if $totalNonVisible < 10 {
				render: "0{$totalNonVisible}";
			} @else {
				render: "{$totalNonVisible}";
			}
		}
	}


	/***
	 * Call data to app-panel:nth-of-type(4).
	**/
	app-panel:nth-of-type(3) panel-list list-item:not-if-var($currentUserID "{@data-id}"):click {
		$currentUserID: "{@data-id}";
		ajax: "{$asidePopulationURL}" get json cache await;
		$item: {JSON}.data[0];
		app-panel:nth-of-type(4) panel-list {
			$asideHTML: "";
			@each $fieldKey in $asideFields {
				$asideHTML: $asideHTML + 
				"<list-item><list-cell>" + $apiSchema[$fieldKey].displayTitle + "</list-cell>" +
				"<list-cell>" + escapeHTML(getVar($item, $apiSchema[$fieldKey].apiLocation)) + "</list-cell></list-item>";
			}
			render: "{$asideHTML}<input id='userID' type='hidden' value='{$item.id}'>";
		}
		run: {=
			const dragonEvent = new Event('rowclicked', { bubbles: true });
			o.obj.dispatchEvent(dragonEvent);
		=};
	}


	/***
	 * Show panels when there are children of panel-list.
	**/
	app-panel:nth-of-type(2) panel-list:not-if-empty:observe {
		body {
			add-class: .nav;
		}
		console-log: "Show NAV";
	}


	/***
	 * Show panels when there are children of panel-list.
	**/
	app-panel:nth-of-type(2) panel-list:not-if-empty:observe {
		body {
			add-class: .nav;
		}
		console-log: "Show NAV";
	}


	/***
	 * Show panels when there are children of panel-list.
	**/
	app-panel:nth-of-type(3) panel-list:not-if-empty:observe {
		body {
			add-class: main;
		}
		console-log: "Show MAIN";
	}


	/***
	 * Hide panel when there are NO children of panel-list.
	**/
	app-panel:nth-of-type(3) panel-list:if-empty:observe {
		body {
			remove-class: main;
		}
		app-panel:nth-of-type(3) {
			remove-attribute: style;
		}
		console-log: "Hide MAIN";
	}


	/***
	 * Show panels when there are children of panel-list.
	**/
	app-panel:nth-of-type(4) panel-list:not-if-empty:observe {
		body {
			add-class: aside;
		}
		console-log: "Show ASIDE";
	}


	/***
	 *
	*/
	app-panel:nth-of-type(4) panel-list #userID:draw { {
		app-panel:nth-of-type(3) panel-list list-item[data-id="{$currentUserID}"] {
			take-class: .active scope(app-panel:nth-of-type(3) panel-list);
			console-log: "Take MAIN .active";
		}
	}


	/* app-panel:nth-of-type(4) panel-list:if-empty:observe{
		app-panel:nth-of-type(3) panel-list list-item.active {
			remove-class: .active;
			console-log: "Remove LIST-ITEM .active";
		}
	} */


	/***
	 * Hide panel when there are NO children of panel-list.
	**/
	app-panel:nth-of-type(4) panel-list:if-empty:observe {
		$currentUserID: null;
		body {
			remove-class: aside;
		}
		console-log: "Hide ASIDE";
		app-panel:nth-of-type(3) panel-list list-item.active {
			remove-class: .active scope(app-panel:nth-of-type(3) panel-list);
			console-log: "Remove MAIN LIST-ITEM .active";
		}
		app-panel:nth-of-type(3) {
			remove-attribute: style;
		}
		console-log: "Remove MAIN size attribute";
	}


	/***
	 * Close the panel when the close button or the same row is clicked. Empty the aside panel.
	**/
	close-panel:click,
	app-panel:nth-of-type(3) panel-list list-item:if-var($currentUserID "{@data-id}"):click {
		empty: app-panel:nth-of-type(4) panel-list;
		console-log: "Empty panel-list to close panel";
	}
    </style>
  </head>

  <body style="opacity: 0.0; transition: opacity 1s ease-in-out;">
    <script>0</script>
    <app-container>
      <app-panel>
        <app-logo>D7460N</app-logo>
        <app-class></app-class>
        <app-user>First LastName</app-user>
      </app-panel>
      <app-panel>
        <panel-header>
          <panel-title>SECTION 01</panel-title>
          <panel-meta>[ 843 ]</panel-meta>
        </panel-header>
        <panel-list>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 1235 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 12 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 35 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 5 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 25 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
        </panel-list>
        <p>&#160;</p>
        <panel-header>
          <panel-title>SECTION 02</panel-title>
          <panel-meta>[ 843 ]</panel-meta>
        </panel-header>
        <panel-list>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 1235 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 12 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 35 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 5 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 25 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
        </panel-list>
        <p>&#160;</p>
        <panel-header>
          <panel-title>SECTION 03</panel-title>
          <panel-meta>[ 843 ]</panel-meta>
        </panel-header>
        <panel-list>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 1235 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 12 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 35 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 5 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 25 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
          <list-item>
            <list-cell><input type="checkbox" /></list-cell>
            <list-cell>Nav Item</list-cell>
            <list-cell>[ 984 ]</list-cell>
          </list-item>
        </panel-list>
      </app-panel>

      <!-- <header>
        <h1>Header Title</h1>
        <small>Header Subtitle</small>
      </header> -->

      <app-panel>
        <panel-header>
          <panel-title>SEARCH RESULTS
            <app-count>
              [&#160;<span id="visibleCount"></span>/<span id="nonVisibleCount"></span>&#160;]
            </app-count>
          </panel-title>
          <list-item>
            <list-cell><a href="#">01</a></list-cell>
            <list-cell><a href="#">02</a></list-cell>
            <list-cell><a href="#">03</a></list-cell>
            <list-cell><a href="#">04</a></list-cell>
            <list-cell><a href="#">05</a></list-cell>
          </list-item>
        </panel-header>
        <list-item>
          <list-headings></list-headings>
        </list-item>
        <panel-list></panel-list>
        <br />
        <app-panel-scroll>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. </p>
        </app-panel-scroll>
        <panel-corner-top-left></panel-corner-top-left>
        <panel-corner-top-right></panel-corner-top-right>
        <panel-corner-bottom-left></panel-corner-bottom-left>
        <panel-corner-bottom-right></panel-corner-bottom-right>
      </app-panel>
      <app-panel>
        <panel-header>
          <panel-title>ASIDE</panel-title>
          <close-panel title="Close panel">[ x ]</close-panel>
        </panel-header>
        <panel-list></panel-list>
        <app-panel-scroll>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
        </app-panel-scroll>
        <panel-corner-top-left></panel-corner-top-left>
        <panel-corner-top-right></panel-corner-top-right>
        <panel-corner-bottom-left></panel-corner-bottom-left>
        <panel-corner-bottom-right></panel-corner-bottom-right>
      </app-panel>
      <app-panel>
        <panel-header>
          <panel-title>ASIDE 2</panel-title>
          <close-panel title="Close panel">[ x ]</close-panel>
        </panel-header>
        <small>Header Subtitle</small>
        <panel-list></panel-list>
        <app-panel-scroll>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
        </app-panel-scroll>
        <panel-corner-top-left></panel-corner-top-left>
        <panel-corner-top-right></panel-corner-top-right>
        <panel-corner-bottom-left></panel-corner-bottom-left>
        <panel-corner-bottom-right></panel-corner-bottom-right>
      </app-panel>
      <app-panel>
        <app-author>D7460N</app-author>
        <app-class></app-class>
        <app-version>v0.001</app-version>
      </app-panel>
    </app-container>

    <script type="text/javascript" charset="utf-8" src="assets/js/activecss-core-dev-2-11-0.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/js/scripts.js"></script>
    <noscript><style>body {opacity: 1.0;}</style></noscript>
  </body>

</html>
